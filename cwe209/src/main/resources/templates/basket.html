


<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
<head>
    <title> Products page </title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/css/basket.css}" >
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <!-- Thymeleaf conditional rendering of script -->
    <script th:if="${session.debugMessage != null}" th:inline="javascript">
        /*<![CDATA[*/
        console.log('Debug Message:', /*[[${session.debugMessage}]]*/ '');
        function product(name){

        }
        /*]]>*/

        function showdate(date) {
            let newdate = new Date(date);
            let dates = (newdate.getDate() < 10) ? '0' + newdate.getDate() : newdate.getDate();
            dates += "/";
            dates += ((newdate.getMonth() + 1) < 10) ? '0' + (newdate.getMonth() + 1) : "" + (newdate.getMonth() + 1);
            dates += "/" + newdate.getFullYear();
            return dates;
        }
    </script>
</head>

<body>
<nav class="navbar navbar-expand-lg bg-body-tertiary" >

    <a class="navbar-brand" th:href="@{/home}">Slatki zalogaji <img th:src="@{/backgrounds/logo.png}" alt="" id="logo"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav" id="menu">

            <li class="nav-item">
                <a class="nav-link" th:href="@{/products}">Products</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/basket}">Basket</a>
            </li>
            <li class="nav-item">
                <form th:action="@{/logout}" method="post">
                    <input type="submit" value="Sign Out" class="btn btn-primary" />
                </form>
            </li>

        </ul>
    </div>
</nav>
<div class="container-fluid cream" th:if="${order}">

    <div class="row">
        <div class="col" th:if="${order} && ${order.product.length>0}">
            <div class="container-fluid" th:with="loggedUserId=${loggeduser._id}">
                <div class="row">
                    <div class="col-lg-12" th:if="${order.status=='pending'}">
                        <h2 th:text="'PorudÅ¾bina ' + ${#dates.format(order.date, 'dd/MM/yyyy')}"></h2>
                    </div>

                </div>
                <div class="row">
                    <div class="col">
                        <div class="row">
                            <div class="col-lg-12">
                                <h2>Order Details</h2>
                            </div>
                            <div class="col productheader">
                                Product
                            </div>
                            <div class="col productheader">
                                Amount
                            </div>
                            <div class="col productheader">
                                Cena
                            </div>
                            <div class="col productheader" th:if="${loggedUserId==order.buyer && order.status=='pending'}">
                                <!-- Content for the column if needed -->
                            </div>
                        </div>
                        <div class="row" th:each="product, iterStat : ${order.products}">
                            <div class="col producttext">
                                <img class="image" th:src="'/products/' + ${map.get(product.productid)._id} + '.' + ${map.get(product.productid).image}">
                                <p style="display: inline;" th:text="${map.get(product.productid).name}"></p>
                            </div>
                            <div class="col producttext" th:text="${product.amount}"></div>
                            <div class="col producttext">
                                <p class="producttext" th:text="${map.get(product.productid).price * product.amount + ' din'}"></p>
                            </div>
                            <div class="col producttext" th:if="${loggedUserId==order.buyer && order.status=='pending'}">
                                <button mat-button th:onclick="'delete(\'' + ${product} + '\')'"><mat-icon>delete</mat-icon></button>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col" id="orderprice">
                                Ukupna cena: <span th:text="${order.totalprice}"></span> din
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-12" id="userinfo">
                        <div class="row">
                            <div class="col"></div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 userdata">
                                <h2>Podaci o dostavi</h2>
                            </div>
                            <div class="col-lg-12 userdata" th:text="${'User: ' + user.firstname + ' ' + user.lastname}"></div>
                            <div class="col-lg-12 userdata"
                                 th:text="${'Adress: ' + user.address.street + ' ' + user.address.number + ', ' + user.address.city}"></div>
                            <div class="col-lg-12 userdata" th:text="${'Contact phone: ' + user.phone}"></div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col" align="right" th:if="${loggedUserId==order.buyer && order.status=='pending'}">
                        <button mat-flat-button onclick="send()">Buy products</button>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>

</div>



</body>
</html>


